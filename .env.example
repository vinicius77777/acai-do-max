DATABASE_URL="mysql://root:senha@localhost:3306/acai_db"
PORT=3000


const exportarPDF = () => {
  try {
    const doc = new jsPDF({
      orientation: "portrait",
      unit: "pt",
      format: "A4",
    });

    const pageWidth = doc.internal.pageSize.getWidth();

    // ======================
    // DATA DO PEDIDO
    // ======================
    const dataPedido =
      pedidosFiltrados.length > 0 &&
      pedidosFiltrados[0].dia_saida &&
      pedidosFiltrados[0].mes_saida &&
      pedidosFiltrados[0].ano_saida
        ? `${String(pedidosFiltrados[0].dia_saida).padStart(2, "0")}/${String(
            pedidosFiltrados[0].mes_saida
          ).padStart(2, "0")}/${pedidosFiltrados[0].ano_saida}`
        : new Date().toLocaleDateString("pt-BR");

    // ======================
    // CABE√áALHO
    // ======================
    doc.setFont("helvetica", "bold");
    doc.setFontSize(14);
    doc.setTextColor("#000");
    doc.text("SA√çDA DE MERCADORIAS", pageWidth / 2, 40, {
      align: "center",
    });

    doc.setFontSize(10);
    doc.line(40, 72, pageWidth - 40, 72);

    // ======================
    // TABELA √öNICA
    // ======================
    const colunas = ["ITEM", "DESCRI√á√ÉO", "QTD", "UN", "UNIT.", "TOTAL"];

    const linhas = pedidosFiltrados.map((p, i) => [
      String(i + 1).padStart(2, "0"),
      p.descricao,
      p.quant_saida ?? "",
      "Pct",
      formatarValor(p.valor_unitario_venda),
      formatarValor(p.valor_total_saida),
    ]);

    const estilosTabela = {
      fontSize: 9.5,       // ‚Üë mais altura
      cellPadding: 6,      // ‚Üë cresce vertical
      fontStyle: "bold",
      textColor: "#000",
      lineColor: "#000",
      lineWidth: 1,
      valign: "middle",
    };

    const estilosHeader = {
      fillColor: "#fff",
      textColor: "#000",
      fontStyle: "bold",
      lineColor: "#000",
      lineWidth: 1,
    };

    // üî• PROPOR√á√ÉO BOA (nem larga nem apertada)
    const columnStyles = {
      0: { cellWidth: 35 },   // ITEM
      1: {
        cellWidth: 220,       // DESCRI√á√ÉO (quebra linha natural)
        halign: "left",
      },
      2: { cellWidth: 40 },   // QTD
      3: { cellWidth: 40 },   // UN
      4: { cellWidth: 65 },   // UNIT
      5: { cellWidth: 70 },   // TOTAL
    };

    autoTable(doc, {
      startY: 90,
      margin: { left: 40, right: 40 },
      head: [colunas],
      body: linhas,
      theme: "grid",
      styles: estilosTabela,
      headStyles: estilosHeader,
      columnStyles,
    } as any);

    // ======================
    // TOTAL (direita, compacto)
    // ======================
    const totalGeral = pedidosFiltrados.reduce(
      (acc, p) => acc + Number(p.valor_total_saida || 0),
      0
    );

    const yTotal = (doc as any).lastAutoTable.finalY + 10;
    const larguraTotal = 200;
    const xTotal = pageWidth - larguraTotal - 40;

    doc.setFontSize(10);
    doc.rect(xTotal, yTotal, larguraTotal, 22);
    doc.text(
      `TOTAL: ${formatarValor(totalGeral)}`,
      xTotal + larguraTotal / 2,
      yTotal + 15,
      { align: "center" }
    );

    // ======================
    // RODAP√â (bem pr√≥ximo)
    // ======================
    autoTable(doc, {
      startY: yTotal + 26,
      margin: { left: 40, right: 40 },
      head: [["DATA", "DESTINO", "RECEBIMENTO"]],
      body: [[
        dataPedido,
        pedidosFiltrados[0]?.localidade || "",
        pedidosFiltrados[0]?.responsavel || "",
      ]],
      theme: "grid",
      styles: {
        fontSize: 9,
        fontStyle: "bold",
        halign: "center",
        textColor: "#000",
        lineColor: "#000",
        lineWidth: 1,
      },
      headStyles: estilosHeader,
    } as any);

    // ======================
    // SALVAR
    // ======================
    doc.save("saida-de-mercadorias.pdf");
  } catch (err) {
    console.error("Erro ao gerar PDF:", err);
    alert("Erro ao gerar PDF. Veja o console.");
  }
};

